# Phase 5 測試計劃 - 下訂單功能

## 📋 測試概述

本測試計劃涵蓋 Phase 5「下訂單功能」的所有核心功能，包括商店瀏覽、遊戲詳細頁面、訂單建立流程等。

### 測試範圍
- ✅ 商店頁面遊戲列表顯示
- ✅ 遊戲詳細頁面
- ✅ 訂單表單功能
- ✅ 認證流程整合
- ✅ API 安全性驗證
- ✅ 錯誤處理機制

---

## 🛠️ 測試環境準備

### 1. 資料庫測試資料

請確保資料庫中有以下測試資料：

#### 遊戲資料 (`game` 表)
```sql
-- 插入測試遊戲
INSERT INTO public.game (game_name, category, icon, is_active) VALUES
('原神', 'RPG', 'https://example.com/genshin.jpg', true),
('崩壞星穹鐵道', 'RPG', 'https://example.com/hsr.jpg', true),
('測試遊戲(停用)', 'Test', null, false);
```

#### 遊戲套餐資料 (`game_packages` 表)
```sql
-- 插入測試套餐 (假設遊戲 ID 為 1)
INSERT INTO public.game_packages (game_id, name, description, price, is_active) VALUES
(1, '小額儲值', '適合新手玩家', 100, true),
(1, '標準儲值', '推薦選擇', 500, true),
(1, '大額儲值', '最划算選擇', 1000, true),
(2, 'Express Supply', 'Honkai Star Rail package', 300, true);
```

#### 付款方式資料 (`payment_method` 表)
```sql
-- 插入測試付款方式
INSERT INTO public.payment_method (method) VALUES
('銀行轉帳'),
('超商代碼'),
('線上支付');
```

#### 允許付款方式關聯 (`allow_payment_method` 表)
```sql
-- 設定遊戲允許的付款方式
INSERT INTO public.allow_payment_method (game_id, payment_method_id) VALUES
(1, 1), (1, 2), (1, 3),  -- 原神支援所有付款方式
(2, 1), (2, 3);          -- 崩壞星穹鐵道支援銀行轉帳和線上支付
```

### 2. 測試帳號

#### 一般使用者帳號
- **Email**: `testuser@example.com`
- **Password**: `testpassword123`
- **is_admin**: `false`

#### 管理員帳號
- **Email**: `admin@example.com`
- **Password**: `adminpassword123`
- **is_admin**: `true`

### 3. 開發伺服器啟動
```bash
cd client
npm run dev
```

---

## 🧪 UI 測試案例

### 測試案例 1: 商店頁面基本功能

#### 1.1 未登入狀態瀏覽商店
**測試步驟:**
1. 開啟瀏覽器，前往 `http://localhost:3000/shop`
2. 檢查頁面載入

**預期結果:**
- ✅ 頁面正常載入，顯示「遊戲商店」標題
- ✅ 顯示所有 `is_active = true` 的遊戲卡片
- ✅ 每個遊戲卡片包含遊戲名稱、類別、圖片或預設圖示
- ✅ 不顯示已停用的遊戲
- ✅ 遊戲卡片有 hover 效果

#### 1.2 響應式設計測試
**測試步驟:**
1. 調整瀏覽器視窗大小 (桌面 → 平板 → 手機)
2. 檢查佈局變化

**預期結果:**
- ✅ 桌面：4 欄網格顯示
- ✅ 平板：2-3 欄網格顯示
- ✅ 手機：1 欄顯示
- ✅ 所有內容可正常顯示，無水平滾動條

### 測試案例 2: 遊戲詳細頁面

#### 2.1 有效遊戲頁面
**測試步驟:**
1. 在商店頁面點擊「原神」遊戲卡片
2. 等待頁面載入

**預期結果:**
- ✅ 導航到 `/shop/1` (遊戲 ID)
- ✅ 顯示遊戲詳細資訊區塊
- ✅ 顯示遊戲圖片或預設圖示
- ✅ 顯示遊戲名稱、類別、描述
- ✅ 顯示「服務中」狀態標籤
- ✅ 顯示「返回商店」按鈕

#### 2.2 無效遊戲 ID 測試
**測試步驟:**
1. 直接訪問 `http://localhost:3000/shop/999` (不存在的 ID)
2. 檢查錯誤處理

**預期結果:**
- ✅ 顯示「遊戲不存在」錯誤訊息
- ✅ 提供「返回商店」按鈕
- ✅ 不會出現 JavaScript 錯誤

#### 2.3 停用遊戲測試
**測試步驟:**
1. 直接訪問停用遊戲的 URL
2. 檢查訪問限制

**預期結果:**
- ✅ 顯示「此遊戲目前暫停服務」訊息
- ✅ 無法進行訂單操作

### 測試案例 3: 訂單表單功能 (未登入)

#### 3.1 未登入狀態測試
**測試步驟:**
1. 確保未登入狀態 (清除瀏覽器 localStorage/cookies)
2. 前往有效遊戲頁面 (如 `/shop/1`)
3. 檢查訂單表單區域

**預期結果:**
- ✅ 顯示「請先登入才能下訂單」訊息
- ✅ 提供「前往登入」按鈕
- ✅ 點擊按鈕導向 `/auth` 頁面

### 測試案例 4: 認證流程測試

#### 4.1 使用者登入
**測試步驟:**
1. 點擊「前往登入」或訪問 `/auth`
2. 輸入測試帳號資訊
   - Email: `testuser@example.com`
   - Password: `testpassword123`
3. 點擊登入

**預期結果:**
- ✅ 成功登入，導向首頁或原頁面
- ✅ 導航列顯示使用者名稱和登出按鈕
- ✅ 儲存登入狀態 (重新整理頁面仍保持登入)

### 測試案例 5: 訂單表單功能 (已登入)

#### 5.1 表單載入測試
**測試步驟:**
1. 確保已登入狀態
2. 前往遊戲詳細頁面 (如 `/shop/1`)
3. 檢查訂單表單

**預期結果:**
- ✅ 顯示完整的訂單表單
- ✅ 套餐下拉選單載入原神的套餐選項
- ✅ 付款方式下拉選單載入該遊戲支援的付款方式
- ✅ 自動選擇第一個套餐和付款方式
- ✅ 顯示遊戲角色資訊輸入欄位

#### 5.2 套餐選擇測試
**測試步驟:**
1. 點擊「選擇套餐」下拉選單
2. 選擇不同套餐選項
3. 檢查訂單摘要更新

**預期結果:**
- ✅ 下拉選單顯示所有啟用的套餐
- ✅ 格式：「套餐名稱 - $價格」
- ✅ 選擇後訂單摘要即時更新
- ✅ 顯示套餐描述 (如果有)

#### 5.3 付款方式選擇測試
**測試步驟:**
1. 點擊「付款方式」下拉選單
2. 選擇不同付款方式
3. 檢查相關資訊顯示

**預期結果:**
- ✅ 下拉選單只顯示該遊戲支援的付款方式
- ✅ 選擇後訂單摘要即時更新

#### 5.4 表單驗證測試
**測試步驟:**
1. 清空「遊戲角色 ID」欄位
2. 點擊「建立訂單」
3. 檢查驗證訊息

**預期結果:**
- ✅ 顯示「請填寫所有必要欄位」錯誤訊息
- ✅ 必填欄位標示清楚 (有 * 號)
- ✅ 表單不會提交

#### 5.5 成功訂單建立測試
**測試步驟:**
1. 填寫完整表單資訊：
   - 選擇套餐：「小額儲值」
   - 選擇付款方式：「銀行轉帳」
   - 遊戲角色 ID：`test123456`
   - 伺服器：`亞洲伺服器`
   - 遊戲角色名稱：`測試角色`
   - 備註：`這是測試訂單`
2. 點擊「建立訂單」
3. 等待回應

**預期結果:**
- ✅ 顯示載入狀態 (按鈕變為「處理中...」)
- ✅ 成功後顯示「訂單建立成功！請等待處理。」
- ✅ 表單重置為初始狀態
- ✅ 在管理後台可以看到新建的訂單

### 測試案例 6: 錯誤處理測試

#### 6.1 網路錯誤模擬
**測試步驟:**
1. 開啟瀏覽器開發者工具
2. 切換到 Network 標籤
3. 設定網路為 Offline
4. 嘗試建立訂單

**預期結果:**
- ✅ 顯示適當的錯誤訊息
- ✅ 不會導致頁面崩潰
- ✅ 使用者可以重試

#### 6.2 無效資料測試
**測試步驟:**
1. 使用瀏覽器開發者工具修改表單資料
2. 嘗試提交無效的 package_id 或 payment_method_id
3. 檢查 API 回應

**預期結果:**
- ✅ API 回傳適當的錯誤訊息
- ✅ 前端顯示錯誤提示

### 測試案例 7: 管理員後台驗證

#### 7.1 新訂單顯示測試
**測試步驟:**
1. 使用管理員帳號登入
2. 前往 `/admin/orders`
3. 檢查剛建立的測試訂單

**預期結果:**
- ✅ 訂單出現在列表中
- ✅ 狀態為 「pending」
- ✅ 顯示正確的使用者、遊戲、套餐資訊
- ✅ 顯示角色 ID 等詳細資料

#### 7.2 訂單狀態更新測試
**測試步驟:**
1. 在訂單列表中找到測試訂單
2. 點擊「處理中」按鈕
3. 確認狀態更新
4. 點擊「完成」按鈕

**預期結果:**
- ✅ 狀態成功更新為 「processing」
- ✅ 狀態成功更新為 「completed」
- ✅ 按鈕狀態即時變更
- ✅ 控制台顯示 Hook 觸發訊息

---

## 🔒 安全性測試

### 測試案例 8: API 安全性

#### 8.1 未授權訂單建立測試
**測試步驟:**
1. 登出所有帳號
2. 使用 Postman 或瀏覽器開發者工具
3. 直接發送 POST 請求到 `/api/orders`

**預期結果:**
- ✅ 回傳 401 未授權錯誤
- ✅ 錯誤訊息：「未授權：請先登入」

#### 8.2 跨使用者資料保護測試
**測試步驟:**
1. 使用 A 使用者登入建立訂單
2. 切換到 B 使用者登入
3. 嘗試存取 A 使用者的訂單

**預期結果:**
- ✅ B 使用者無法看到 A 使用者的訂單
- ✅ API 正確過濾使用者權限

---

## 📱 跨瀏覽器測試

### 支援的瀏覽器
- ✅ Chrome (最新版本)
- ✅ Firefox (最新版本)
- ✅ Safari (最新版本)
- ✅ Edge (最新版本)

### 行動裝置測試
- ✅ iOS Safari
- ✅ Android Chrome
- ✅ 響應式設計在各種螢幕尺寸下正常運作

---

## 📊 效能測試

### 載入時間測試
- ✅ 商店頁面載入時間 < 2 秒
- ✅ 遊戲詳細頁面載入時間 < 1 秒
- ✅ 訂單提交回應時間 < 3 秒

### 大量資料測試
- ✅ 商店頁面可正常顯示 100+ 遊戲
- ✅ 套餐下拉選單可處理 50+ 選項

---

## ✅ 測試檢查清單

### 功能測試
- [ ] 商店頁面正常顯示遊戲列表
- [ ] 遊戲卡片點擊正常跳轉
- [ ] 遊戲詳細頁面資訊正確顯示
- [ ] 未登入狀態正確引導登入
- [ ] 登入後訂單表單正常顯示
- [ ] 套餐和付款方式正確載入
- [ ] 表單驗證正常運作
- [ ] 訂單成功建立並顯示在後台
- [ ] 錯誤處理機制正常運作

### UI/UX 測試
- [ ] 響應式設計在各裝置正常
- [ ] 載入狀態顯示合適
- [ ] 錯誤訊息清楚易懂
- [ ] 按鈕和連結都有適當的 hover 效果
- [ ] 色彩對比度符合無障礙標準

### 安全性測試
- [ ] 未授權 API 存取被正確阻擋
- [ ] 使用者只能存取自己的資料
- [ ] 輸入資料經過適當驗證
- [ ] SQL Injection 攻擊防護

### 效能測試
- [ ] 頁面載入時間在合理範圍
- [ ] 大量資料處理正常
- [ ] 無記憶體洩漏問題

---

## 🐛 測試結果記錄

| 測試案例 | 狀態 | 執行時間 | 備註 |
|---------|------|---------|------|
| 商店頁面基本功能 | ⏳ 待測試 | - | - |
| 遊戲詳細頁面 | ⏳ 待測試 | - | - |
| 訂單表單功能 | ⏳ 待測試 | - | - |
| 認證流程 | ⏳ 待測試 | - | - |
| 錯誤處理 | ⏳ 待測試 | - | - |
| 安全性測試 | ⏳ 待測試 | - | - |

### 發現的問題
*(在測試過程中記錄發現的問題)*

### 修復狀態
*(記錄問題修復的狀態)*

---

## 📝 測試完成標準

Phase 5 測試完成的標準：
1. ✅ 所有功能測試案例通過
2. ✅ 所有安全性測試通過
3. ✅ 跨瀏覽器相容性確認
4. ✅ 響應式設計驗證
5. ✅ 效能標準達成
6. ✅ 無嚴重 bug 存在

完成測試後，Phase 5 即可進入生產環境部署。 